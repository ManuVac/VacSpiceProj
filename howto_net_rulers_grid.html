<HTML>
<META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.rsac.org/ratingsv01.html" l gen true comment "RSACi North America Server" by "RodStephens@vb-helper.com" for "http://www.vb-helper.com" on "1998.03.17T18:18-0800" r (n 0 s 0 v 0 l 0))'>
<HEAD>
<TITLE>VB Helper: HowTo: Make a simple drawing program with a "snap to" grid and rules in Visual Basic .NET</TITLE>
<META NAME="Author" CONTENT="Rod Stephens">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Keywords" CONTENT="drawing, graphics, grid, snap to, snapto, ruler, Visual Basic .NET, VB.NET">
<META NAME="Keywords" CONTENT="drawing, graphics, grid, snap to, snapto, ruler, Visual Basic .NET, VB.NET">
<META NAME="Description" CONTENT="VB Helper: HowTo: Make a simple drawing program with a "snap to" grid and rules in Visual Basic .NET">
<META NAME="Copyright" CONTENT="Copyright 1997-2008, Rocky Mountain Computer Consulting, Inc.">
<META NAME="Rating" CONTENT="General">
<META NAME="Robots" CONTENT="All">
<LINK REL="icon" HREF="http://www.vb-helper.com/vbhelper_icon.ico">
</HEAD>

<BODY BGCOLOR="#E1F3FF" BACKGROUND="bg_blue.jpg">

  <!-- This table contains the banner, menu column, and content. -->
  <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
    <!-- ****** -->
    <!-- Banner -->
    <!-- ****** -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="Left">
        <TR>
          <TD BACKGROUND="banner_mid.jpg"><IMG SRC="banner_l.jpg" WIDTH="410" HEIGHT="64"></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="banner_r.jpg" WIDTH="32" HEIGHT="64"></TD>
        </TR>
      </TABLE>
    </TD></TR>
    <TR><TD>&nbsp;</TD></TR>

    <!-- Menu column and content -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="2" CELLPADDING="0">
        <!-- *********** -->
        <!-- Menu column -->
        <!-- *********** -->
        <TR>
          <TD ALIGN="Left" VALIGN="Top">
            <TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- Menu top -->
              <TR>
                <TD><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_um.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Menu entries -->
              <TR BGCOLOR="#7FCFFF">
                <TD BACKGROUND="blue_l.jpg" WIDTH="16">&nbsp;</TD>
                <TD><CENTER>
                  <A HREF="index.html"><B><FONT SIZE="+1">Home</FONT></B></A><BR>
                  <A HREF="search.html"><B>Search</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="whats_new.html"><B>What's New</B></A><BR>
                  <A HREF="index_categories.html"><B>Index</B></A><BR>
                  <A HREF="books.html"><B>Books</B></A><BR>
                  <A HREF="links.html"><B>Links</B></A><BR>
                  <A HREF="http://www.topica.com/lists/VBHelperQA/read"><B>Q &amp; A</B></A><BR>
                  <A HREF="newsletter.html"><B>Newsletter</B></A><BR>
                  <A HREF="banners.html"><B>Banners</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="http://astore.amazon.com/vbhelper/about"><B>Bookstore...</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="mailto:feedback@vb-helper.com"><B>Feedback</B></A><BR>
                  <A HREF="tip_jar.html"><B>Tip Jar</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="feed.xml"><IMG SRC="xml_rss.jpg" BORDER="0" ALT="XML RSS Feed"></A><BR>
                </CENTER></TD>
                <TD BACKGROUND="blue_r.jpg" WIDTH="16">&nbsp;</TD>
              </TR>

              <!-- Menu bottom -->
              <TR>
                <TD><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lm.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ******** -->
              <!-- Partners -->
              <!-- ******** -->

              <!-- MVP -->
              <TR><TD COLSPAN="3"><A HREF="http://www.mvps.org"><IMG SRC="mvp_logo.gif" BORDER="0"></A></TR></TD>
              <TR><TD HEIGHT="20" COLSPAN="3">&nbsp;</TR></TD>

              <!-- MSDN VB Community -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<A HREF="http://msdn.microsoft.com/vbasic/community/default.aspx">MSDN Visual Basic Community</A>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon Recommends -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<!-- -->
                <SCRIPT SRC="http://rcm.amazon.com/e/cm?t=vbhelper&l=rc1&p=2&o=1" TYPE="text/JavaScript"></SCRIPT>
<!-- -->
                <NOSCRIPT>
                  <TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="125">
                    <TR><TD>
                      <MAP NAME="boxmap">
                        <AREA SHAPE="RECT" COORDS="18, 263, 105, 274" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1">
                        <AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/vbhelper">
                      </MAP>
                      <img src="http://rcm-images.amazon.com/images/G/01/associates/amzn_recommends/gnbox125x275.gif" width="125" height="275" border="0" usemap="#boxmap">
                    </TD></TR>
                  </TABLE>
                </NOSCRIPT>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Wiley -->
              <TR><TD COLSPAN="3" ALIGN="Center" BACKGROUND="sandpaper.gif"><A HREF="http://service.bfast.com/bfast/click?bfmid=37920629&siteid=40078832&bfpage=computer_science" TARGET="_top"><IMG SRC="wiley_logo.gif" BORDER="0" ALIGN="Center" WIDTH="77" HEIGHT="105"></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Que -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="http://www.quepublishing.com"><IMG SRC="que.gif" BORDER="0" ALIGN="Center" WIDTH="121" HEIGHT="36"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="amazon.html"><IMG SRC="amazon_logo.gif" BORDER="0" ALIGN="Center" WIDTH="68" HEIGHT="65"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ********** -->
              <!-- More stuff -->
              <!-- ********** -->

            </TABLE>
          </TD>

          <!-- A little space between the menus and content -->
          <TD WIDTH="5">&nbsp;</TD>

          <!-- ******* -->
          <!-- Content -->
          <!-- ******* -->
          <TD WIDTH="100%" ALIGN="Left" VALIGN="Top">
            <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- How To Summary -->
              <TR><TD>
                <TABLE WIDTH="100%" BORDER="2" CELLSPACING="0" CELLPADDING="2">
                  <TR><TH ALIGN="Left">Title</TH><TD WIDTH="100%">Make a simple drawing program with a "snap to" grid and rules in Visual Basic .NET</TD></TR>
                  <TR><TH ALIGN="Left">Description</TH><TD WIDTH="100%">This example shows how to make a simple drawing program with a "snap to" grid and rules in Visual Basic .NET.</TD></TR>
                  <TR><TH ALIGN="Left">Keywords</TH><TD>drawing, graphics, grid, snap to, snapto, ruler, Visual Basic .NET, VB.NET</TD></TR>
                  <TR><TH ALIGN="Left">Categories</TH><TD>VB.NET, Graphics</TD></TR>
                </TABLE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
When you press the mouse down on the main drawing canvas, the code starts drawing. It sets m_Drawing to True so it can remember that it is drawing. It calls SnapToGrid to snap the current point to the nearest grid point and saves that point. It invalidates the drawing area to redraw and calls ShowMousePosition to show the mouse position in the rulers usin the "drawing" color.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Start drawing a line.</FONT>
Private Sub picCanvas_MouseDown(ByVal sender As Object, _
    ByVal e As System.Windows.Forms.MouseEventArgs) Handles _
    picCanvas.MouseDown
    <FONT COLOR="#008000">' Only on left mouse down.</FONT>
    If e.Button &lt;&gt; Windows.Forms.MouseButtons.Left Then _
        Exit Sub
    m_Drawing = True

    <FONT COLOR="#008000">' Start drawing.</FONT>
    m_X1 = e.X
    m_Y1 = e.Y
    SnapToGrid(m_X1, m_Y1)
    m_X2 = m_X1
    m_Y2 = m_Y1

    picCanvas.Invalidate()
    ShowMousePosition(m_X2, m_Y2)
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
Subroutine SnapToGrid snaps a point to the nearest grid location. It determines how many times the grid's size fits into the available canvas size, rounding to the nearest integer. It then multiplies that number by the grid size so get the nearest grid location.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Snap the point to the nearest grid location.</FONT>
Private Sub SnapToGrid(ByRef X As Integer, ByRef Y As _
    Integer)
    <FONT COLOR="#008000">' If grid snap is off, do nothing.</FONT>
    If Not m_SnapToGrid Then Exit Sub

    Dim ix As Integer = CInt(X / m_GridX)
    Dim iy As Integer = CInt(Y / m_GridY)
    X = ix * m_GridX
    Y = iy * m_GridY
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
Subroutine ShowMousePosition saves a point's coordinates and invalidates the two rulers to make them redraw.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Show the mouse position on the rulers.</FONT>
Private Sub ShowMousePosition(ByVal X As Integer, ByVal Y _
    As Integer)
    m_MouseX = X
    m_MouseY = Y
    picTopRuler.Invalidate()
    picLeftRuler.Invalidate()
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
The main canvas's MouseMove evnet handler saves the current mouse position, snaps it to the grid, shows the mouse position, and redraws the main canvas to show the new line being drawn.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Continue drawing.</FONT>
Private Sub picCanvas_MouseMove(ByVal sender As Object, _
    ByVal e As System.Windows.Forms.MouseEventArgs) Handles _
    picCanvas.MouseMove
    m_X2 = e.X
    m_Y2 = e.Y
    SnapToGrid(m_X2, m_Y2)

    <FONT COLOR="#008000">' Show the mouse position on the rulers.</FONT>
    ShowMousePosition(m_X2, m_Y2)

    <FONT COLOR="#008000">' Redraw.</FONT>
    If m_Drawing Then picCanvas.Invalidate()
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
The MouseUp event handler shows the mouse position in the non-drawing color. It then saves the new line segement and redraws to show it in the non-drawing color.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Finish drawing.</FONT>
Private Sub picCanvas_MouseUp(ByVal sender As Object, ByVal _
    e As System.Windows.Forms.MouseEventArgs) Handles _
    picCanvas.MouseUp
    If Not m_Drawing Then Exit Sub
    m_Drawing = False

    <FONT COLOR="#008000">' Show the mouse position in the non-drawing color.</FONT>
    ShowMousePosition(m_X2, m_Y2)

    <FONT COLOR="#008000">' Save the new line.</FONT>
    Dim new_index As Integer = m_Points1.Length
    ReDim Preserve m_Points1(new_index)
    ReDim Preserve m_Points2(new_index)
    m_Points1(new_index) = New PointF(m_X1, m_Y1)
    m_Points2(new_index) = New PointF(m_X2, m_Y2)

    picCanvas.Invalidate()
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
The main canvas's Paint event handler clears the canvas. Then if m_ShowGrid is True, it draws the grid. It then draws any existing line segments and finally, if a new line is being drawn, it draws that line.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Draw the lines.</FONT>
Private Sub picCanvas_Paint(ByVal sender As Object, ByVal e _
    As System.Windows.Forms.PaintEventArgs) Handles _
    picCanvas.Paint
    e.Graphics.Clear(picCanvas.BackColor)

    <FONT COLOR="#008000">' Draw the grid.</FONT>
    If m_ShowGrid Then
        For x As Integer = 0 To picCanvas.ClientSize.Width _
            Step m_GridX
            For y As Integer = 0 To _
                picCanvas.ClientSize.Height Step m_GridY
                e.Graphics.DrawLine(m_PenGrid, x, y, x + _
                    0.5F, y + 0.5F)
            Next y
        Next x
    End If

    <FONT COLOR="#008000">' Draw existing lines.</FONT>
    For i As Integer = 0 To m_Points1.Length - 1
        e.Graphics.DrawLine(m_PenOldLine, m_Points1(i), _
            m_Points2(i))
    Next i

    <FONT COLOR="#008000">' Draw the new line.</FONT>
    If m_Drawing Then
        e.Graphics.DrawLine(m_PenNewLine, m_X1, m_Y1, m_X2, _
            m_Y2)
    End If
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
The top ruler's Paint event handler clears the control. It then draws the tick marks using the grid's spacing and giving greater length to every 5 and 10 tick marks. Finally it draws the mouse's position in an appropriate color. The Left ruler's Paint event handler works similarly.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Draw the top ruler.</FONT>
Private Sub picTopRuler_Paint(ByVal sender As Object, ByVal _
    e As System.Windows.Forms.PaintEventArgs) Handles _
    picTopRuler.Paint
    e.Graphics.Clear(picTopRuler.BackColor)

    Dim y1 As Integer = picTopRuler.ClientSize.Height
    Dim y2 As Integer = (2 * picTopRuler.ClientSize.Height) _
        \ 3
    Dim y3 As Integer = picTopRuler.ClientSize.Height \ 3
    Dim y4 As Integer = 0
    Dim x As Integer = 0
    For i As Integer = 0 To picTopRuler.ClientSize.Width \ _
        m_GridX
        If i Mod 10 = 0 Then
            e.Graphics.DrawLine(m_PenGrid, x, y1, x, y4)
        ElseIf i Mod 5 = 0 Then
            e.Graphics.DrawLine(m_PenGrid, x, y1, x, y3)
        Else
            e.Graphics.DrawLine(m_PenGrid, x, y1, x, y2)
        End If
        x += m_GridX
    Next i

    <FONT COLOR="#008000">' Show the mouse position.</FONT>
    If m_Drawing Then
        e.Graphics.DrawLine(m_PenRulerDrawing, m_MouseX, _
            y1, m_MouseX, 0)
    Else
        e.Graphics.DrawLine(m_PenRulerNormal, m_MouseX, y1, _
            m_MouseX, 0)
    End If
End Sub</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
Download the example to see additional details such as how the menus let you show or hide the grid and turn grid snapping on and off.
<P>
This example is fairly basic and there are lots of other features you could add such as zooming, panning, drawing other shapes, and so forth.
              </TD></TR>

              <!-- *************** -->
              <!-- Download button -->
              <!-- *************** -->

              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>
              <TR><TD ALIGN="Center"><A HREF="HowTo/howto_net_rulers_grid.zip"><IMG SRC="download.jpg" BORDER="0"></A></TD></TR>
              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>

            </TABLE> <!-- End content table -->
          </TD> <!-- End content column -->

          <!-- ************** -->
          <!-- Google AdSense -->
          <!-- ************** -->
          <TD WIDTH="120" ALIGN="Right" VALIGN="Top">
            <TABLE WIDTH="165" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <TR><TD ALIGN="Right">

<script type="text/javascript"><!--
google_ad_client = "pub-6627515316741006";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_channel ="4974732445";
google_color_border = "00CC66";
google_color_bg = "99FF99";
google_color_link = "0000FF";
google_color_url = "0033FF";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

              </TD></TR>
            </TABLE> <!-- End Google AdSense table -->
          </TD> <!-- End Google AdSense column -->


        </TR> <!-- End row containing menu column and content -->
      </TABLE> <!-- End table containing menu column and content -->
    </TD></TR>

    <!-- ****** -->
    <!-- Footer -->
    <!-- ****** -->
    <TR><TD WIDTH="100%">
      <TABLE WIDTH="100%" BORDER="0" BGCOLOR="#87CEFA" CELLSPACING="0" CELLPADDING="0">
        <!-- Top row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_um.jpg" COLSPAN="2" ALIGN="Center"><FONT SIZE="-2">
            Copyright &copy; 1997-2008 Rocky Mountain Computer Consulting, Inc. &nbsp; All rights reserved.
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>

        <!-- Bottom row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_lm.jpg"><FONT SIZE="-2">
            &nbsp;<SCRIPT LANGUAGE=JavaScript>document.write(document.URL)</SCRIPT></FONT></TD>
          <TD BACKGROUND="blue_lm.jpg" ALIGN="Right"><FONT SIZE="-2">
            Updated <SCRIPT LANGUAGE=JavaScript>document.write(document.lastModified)</SCRIPT> &nbsp;
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>
      </TABLE>
    </TD></TR>
  </TABLE> <!-- End table containing banner, menu column + content, and footer -->

</BODY>
</HTML>